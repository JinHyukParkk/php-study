# 8.1 소스 코드 유출2
 웹 서버에서 소스 코드를 실행하려면 소스 코드를 먼저 읽어들여야 합니다. 즉, 웹 서버가 실핼할 수 있는 코드를 작성할 수 있는 사람이면 타 소스 또한 읽을 수 있다는 것을 의미합니다. 이러한 공유는 심각한 위험이고, 서버를 이용하는 다른 개발자가 간단한 PHP 소스를 통해 임의의 파일을 읽을 수 있을 것입니다.
 ```
 <?php
    header('Content-Type: text/plain');
    readfile($_GET['file']);    
?>
 ```
 해당 소스가 실행되고 있다면 공격자는 file의 값에 전체 경로와 파일 이름을 입력해서 웹 서버에 있는 어떤 파일이든 읽어들일 수 있습니다. 예를 들어, 이 스크립트의 파일 이름이 file.php이고, test.com에서 제공되고 있다면 다음 주소를 방문하는 식으로 /path/to/source.php 같은 파일을 노출시킬 수 있습니다.
 ```
 http://test.com/file.php?file=/path/to/source.php
 ```
 물론, 공격자가 이 스크립트를 유용하게 사용하려면 소스 코드가 있는 위치를 알아야만 하지만 파일 시스템을 편하게 탐색할 수 있는 보다 복잡한 형태의 스크립트를 작성할 수도 있습니다. 파일 시스템을 탐색하는 스크립트 예제는 마지막 장에 소개되어 있습니다.

 그렇다면 5장에서 다루었던 웹 서버 밑에 저장된 모든 소스 코드는 공개된 것으로 간주해야 합니다. 최선의 방법은 모든 중요한 데이터를 데이터베이스에 저장해야하지만 데이터베이스 엑세스 인증 정보는 데이터베이스에 저장할 수 없으므로 어딘가에 저장을 해야합니다.
 웹 서버 루트 바깥에 db.inc 이 있다고 가정 한다면 
 ```
 <?php
    $db_user = 'myuser';
    $db_pass = 'mypass';
    $db_host = 'localhost';

    $db = mysql_connect($db_host, $db_user, $db_pass);
 ?>
 ```
 하지만 우베 서버 밑에 저장된 모든 소스를 공개된 것으로 간주한다면 이 방법은 약점이 분명 있을 것입니다. 그래서 가장 좋은 해결책을 root만 읽을 수 있는 파일에 데이터베이스 엑세스 인증 정보를 저장하는 것입니다.
 ```
 SetEnv DB_USER "myuser"
 SetEnv DB_PASS "mypass"
 ```
 SetEnv는 아파치 설정 지시문이며 위 파일 형신은 아파치에 데이터베이스 사용자 이름과 비밀번호에 대한 환경변수를 생성시킵니다. 물론, 이 방법의 핵심은 오직 root 사용자만 파일을 읽을 수 있다는 것입니다. 해당 파일이 유용하려면 PHP에서 이 데이터를 액세스를 할 수 있어야하고 이를 위해 httpd.conf에 해당 파일을 포함시켜야합니다.
 ```
 include "/path/to/db.conf"
 ```
 해당 환경 변수를 사용하기 위해 수퍼 전역변수인 $_SERVER로 액세스가 가능합니다.
 ```
 <?php
    $db_user = $_SERVER['DB_USER'];
    $db_pass = $_SERVER['DB_PASS'];
    $db_host = 'localhost';

    $db = mysql_connect($db_host, $db_user, $db_pass);
 ?>
 ```
 이 파일이 유출되더라도 데이터베이스 액세스 인증 정보는 노출되지 않을 것입니다. 해당 방법은 보안을 상당히 높여주며 전용 호스팅 환경에서도 심층 방어 수단으로 가치있는 방법입니다.
